"use client";
import { CircularProgress } from "@mui/material";
import { signIn } from "next-auth/react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useState } from "react";
import { useForm, SubmitHandler, Controller } from "react-hook-form";

export default function Login() {
  const [togglePassword, setTogglePassword] = useState(false);
  const [errorMessage, setErrorMessage] = useState("");
  const [loading, setLoading] = useState(false);
  const router = useRouter();
  const { handleSubmit, control } = useForm();
  const onSubmit = async (e) => {
    setErrorMessage("");
    setLoading(true);
    try {
      const response = await signIn("credentials", {
        ...e,
        redirect: false,
      });
      if (response && response.status === 401) {
        setErrorMessage("NIM atau Password Anda salah");
        return;
      }
      if (response && response.status === 200) {
        router.replace("/dashboard");
      }
    } catch (error) {
      console.error("Error:", error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <div className="relative max-h-screen h-screen bg-[#1E5AF9]">
        <div className="flex h-[35vh] justify-center items-end pb-6">
          <img className="h-[65%]" src="/assets/Logo.png" alt="Vote Icon" />
        </div>
        <form onSubmit={handleSubmit(onSubmit)}>
          <div className="flex flex-col max-w-[80%] md:max-w-[25rem] mx-auto items-center space-y-6">
            {errorMessage && (
              <div className="text-white px-6 py-2 rounded-lg bg-red-600/80">
                {errorMessage}
              </div>
            )}
            <div className="w-full flex items-center bg-white/25 space-x-3 rounded-full outline outline-2 outline-offset-[-2px] outline-white overflow-hidden">
              <div className="bg-white p-3 pl-4">
                <svg
                  width="20"
                  height="21"
                  viewBox="0 0 20 21"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M13.646 10.7155C14.6264 9.94415 15.342 8.88642 15.6933 7.68944C16.0445 6.49246 16.014 5.21576 15.6058 4.03696C15.1977 2.85817 14.4323 1.83589 13.4161 1.11235C12.3999 0.388815 11.1835 0 9.93603 0C8.68858 0 7.47215 0.388815 6.45596 1.11235C5.43978 1.83589 4.67438 2.85817 4.26624 4.03696C3.85811 5.21576 3.82754 6.49246 4.17879 7.68944C4.53004 8.88642 5.24564 9.94415 6.22603 10.7155C4.54611 11.3885 3.08032 12.5048 1.98492 13.9454C0.88953 15.386 0.205595 17.0968 0.00603184 18.8955C-0.00841357 19.0268 0.00314838 19.1597 0.0400573 19.2866C0.0769662 19.4134 0.138499 19.5317 0.221143 19.6348C0.388051 19.843 0.630815 19.9763 0.896032 20.0055C1.16125 20.0347 1.42719 19.9573 1.63536 19.7904C1.84352 19.6235 1.97686 19.3807 2.00603 19.1155C2.22562 17.1607 3.15772 15.3553 4.62425 14.0443C6.09078 12.7333 7.98893 12.0085 9.95603 12.0085C11.9231 12.0085 13.8213 12.7333 15.2878 14.0443C16.7543 15.3553 17.6864 17.1607 17.906 19.1155C17.9332 19.3612 18.0505 19.5882 18.2351 19.7525C18.4198 19.9169 18.6588 20.007 18.906 20.0055H19.016C19.2782 19.9753 19.5178 19.8428 19.6826 19.6367C19.8474 19.4307 19.9241 19.1679 19.896 18.9055C19.6955 17.1017 19.0079 15.3865 17.9069 13.9437C16.8059 12.5009 15.3329 11.385 13.646 10.7155ZM9.93603 10.0055C9.14491 10.0055 8.37155 9.7709 7.71375 9.33137C7.05595 8.89185 6.54326 8.26713 6.24051 7.53623C5.93776 6.80533 5.85855 6.00106 6.01289 5.22513C6.16723 4.44921 6.54819 3.73648 7.1076 3.17707C7.66701 2.61766 8.37975 2.2367 9.15567 2.08235C9.93159 1.92801 10.7359 2.00723 11.4668 2.30998C12.1977 2.61273 12.8224 3.12542 13.2619 3.78321C13.7014 4.44101 13.936 5.21437 13.936 6.0055C13.936 7.06636 13.5146 8.08378 12.7645 8.83392C12.0143 9.58407 10.9969 10.0055 9.93603 10.0055Z"
                    fill="#1E5AF9"
                  />
                </svg>
              </div>
              <Controller
                name="nim"
                control={control}
                render={({ field }) => (
                  <input
                    className="w-full bg-transparent font-RalewayRegular text-sm text-white placeholder:text-white focus:outline-none"
                    type="text"
                    autoComplete="off"
                    placeholder="Nomor Induk Mahasiswa / NIM"
                    required
                    {...field}
                  />
                )}
              />
            </div>
            <div className="w-full flex items-center bg-white/25 space-x-3 rounded-full outline outline-2 outline-offset-[-2px] outline-white overflow-hidden">
              <div className="bg-white p-3 pl-4">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M14.4301 4.09799C14.0427 4.09747 13.659 4.17325 13.3009 4.32102C12.9428 4.46878 12.6173 4.68564 12.343 4.9592C12.0687 5.23276 11.851 5.55767 11.7022 5.91538C11.5535 6.27309 11.4767 6.65659 11.4761 7.04399C11.4768 7.43139 11.5537 7.81487 11.7026 8.17253C11.8515 8.53019 12.0693 8.85503 12.3437 9.1285C12.6181 9.40197 12.9437 9.61871 13.3018 9.76635C13.66 9.914 14.0437 9.98965 14.4311 9.989C15.2134 9.99006 15.964 9.68041 16.5179 9.12814C17.0719 8.57588 17.3838 7.82621 17.3851 7.04399C17.3846 6.65659 17.3078 6.27309 17.159 5.91538C17.0103 5.55767 16.7926 5.23276 16.5183 4.9592C16.244 4.68564 15.9185 4.46878 15.5604 4.32102C15.2022 4.17325 14.8175 4.09747 14.4301 4.09799ZM12.9761 7.04399C12.9767 6.85349 13.0147 6.66496 13.0881 6.48918C13.1616 6.31339 13.2689 6.15379 13.404 6.01951C13.5391 5.88522 13.6994 5.77887 13.8756 5.70655C14.0519 5.63422 14.2406 5.59734 14.4311 5.59799C15.2371 5.59799 15.8851 6.24799 15.8851 7.04399C15.8838 7.42839 15.7299 7.79652 15.4573 8.06748C15.1846 8.33845 14.8155 8.49006 14.4311 8.489C14.0467 8.49006 13.6777 8.33845 13.405 8.06748C13.1324 7.79652 12.9785 7.42839 12.9771 7.04399H12.9761Z"
                    fill="#1E5AF9"
                  />
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M8.28015 19.628C8.56951 19.2363 8.72138 18.7599 8.71215 18.273C9.10415 18.389 9.49215 18.403 9.86415 18.333C10.6321 18.187 11.2011 17.701 11.5031 17.301L11.5081 17.294L11.5131 17.287C11.7234 17 11.8679 16.6703 11.9363 16.3211C12.0048 15.972 11.9955 15.6121 11.9091 15.267C11.8361 14.966 11.7145 14.6789 11.5491 14.417C11.473 14.2765 11.3818 14.1447 11.2771 14.024L11.2861 14.014L11.7501 13.552C12.1321 13.735 12.5461 13.85 12.9081 13.925C13.4094 14.0278 13.9195 14.0821 14.4311 14.087C18.3321 14.087 21.5001 10.937 21.5001 7.043C21.5001 3.151 18.3321 0 14.4301 0C10.5301 0 7.36115 3.15 7.36115 7.043C7.36547 7.95146 7.55962 8.84898 7.93115 9.678L0.675146 16.904C0.336407 17.2466 0.110331 17.6844 0.0271461 18.159C-0.0718539 18.762 0.0901461 19.433 0.675146 20.015L1.55715 20.893C1.90653 21.201 2.33619 21.4036 2.79615 21.477C3.11021 21.5255 3.43132 21.4977 3.7324 21.3961C4.03349 21.2944 4.30572 21.1219 4.52615 20.893L5.09215 20.329C5.57981 20.6141 6.15451 20.7122 6.70915 20.605C7.32812 20.4823 7.88202 20.1403 8.26915 19.642L8.27515 19.635L8.28015 19.628ZM8.86115 7.043C8.86115 3.985 11.3521 1.5 14.4311 1.5C17.5091 1.5 20.0001 3.985 20.0001 7.043C20.0001 10.103 17.5101 12.587 14.4301 12.587C14.1581 12.587 13.6871 12.554 13.2121 12.457C12.7151 12.353 12.3251 12.2 12.1171 12.027C11.9734 11.908 11.7905 11.8469 11.6041 11.8556C11.4177 11.8643 11.2412 11.9422 11.1091 12.074L10.2271 12.952C10.0261 13.152 9.83215 13.38 9.72915 13.643C9.59915 13.976 9.64115 14.296 9.78915 14.563C9.87715 14.72 10.0191 14.87 10.0781 14.933L10.0981 14.954C10.1681 15.031 10.2051 15.081 10.2331 15.137L10.2601 15.19L10.2901 15.232L10.2971 15.242C10.3665 15.358 10.4181 15.4837 10.4501 15.615C10.5041 15.844 10.5041 16.115 10.3001 16.405C10.1211 16.6345 9.86809 16.7949 9.58415 16.859C9.32715 16.908 8.90715 16.876 8.34715 16.319C8.20656 16.1789 8.01615 16.1002 7.81765 16.1002C7.61914 16.1002 7.42873 16.1789 7.28815 16.319L6.99415 16.611C6.85823 16.7461 6.77919 16.9281 6.77324 17.1196C6.76729 17.3112 6.83488 17.4977 6.96215 17.641C7.0479 17.7567 7.11536 17.8848 7.16215 18.021C7.23715 18.246 7.24915 18.487 7.06615 18.747C6.94615 18.902 6.70315 19.079 6.42715 19.131C6.19315 19.176 5.89315 19.143 5.55515 18.806C5.41456 18.6659 5.22415 18.5872 5.02565 18.5872C4.82714 18.5872 4.63673 18.6659 4.49615 18.806L3.46715 19.831C3.30215 19.995 3.15715 20.014 3.01515 19.993C2.86078 19.9658 2.7153 19.9017 2.59115 19.806L1.73415 18.952C1.49515 18.715 1.48615 18.532 1.50715 18.402C1.53933 18.2379 1.61814 18.0865 1.73415 17.966L9.37815 10.353C9.49793 10.2336 9.57356 10.077 9.59264 9.90889C9.61171 9.74081 9.57311 9.57125 9.48315 9.428L9.48115 9.425C9.4517 9.37618 9.42435 9.32614 9.39915 9.275C9.0498 8.58255 8.86565 7.81857 8.86115 7.043ZM6.95115 17.626C6.95115 17.628 6.95315 17.629 6.95515 17.631L6.95415 17.63L6.95115 17.626Z"
                    fill="#1E5AF9"
                  />
                </svg>
              </div>
              <Controller
                name="password"
                control={control}
                render={({ field }) => (
                  <input
                    className="w-full bg-transparent font-RalewayRegular text-sm text-white placeholder:text-white focus:outline-none"
                    type={togglePassword ? "text" : "password"}
                    autoComplete="off"
                    placeholder="Password"
                    required
                    {...field}
                  />
                )}
              />
              <div className="pr-4">
                <svg
                  className="w-6 fill-white cursor-pointer"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 576 512"
                  onClick={() => setTogglePassword(!togglePassword)}
                >
                  {togglePassword ? (
                    <path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zm151 118.3C226 97.7 269.5 80 320 80c65.2 0 118.8 29.6 159.9 67.7C518.4 183.5 545 226 558.6 256c-12.6 28-36.6 66.8-70.9 100.9l-53.8-42.2c9.1-17.6 14.2-37.5 14.2-58.7c0-70.7-57.3-128-128-128c-32.2 0-61.7 11.9-84.2 31.5l-46.1-36.1zM394.9 284.2l-81.5-63.9c4.2-8.5 6.6-18.2 6.6-28.3c0-5.5-.7-10.9-2-16c.7 0 1.3 0 2 0c44.2 0 80 35.8 80 80c0 9.9-1.8 19.4-5.1 28.2zm9.4 130.3C378.8 425.4 350.7 432 320 432c-65.2 0-118.8-29.6-159.9-67.7C121.6 328.5 95 286 81.4 256c8.3-18.4 21.5-41.5 39.4-64.8L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5l-41.9-33zM192 256c0 70.7 57.3 128 128 128c13.3 0 26.1-2 38.2-5.8L302 334c-23.5-5.4-43.1-21.2-53.7-42.3l-56.1-44.2c-.2 2.8-.3 5.6-.3 8.5z" />
                  ) : (
                    <path d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z" />
                  )}
                </svg>
              </div>
            </div>
            <button className="w-full h-12 flex items-center justify-center font-RalewayExtraBold text-xl text-[#1E5AF9] bg-white rounded-full uppercase">
              {loading ? (
                <CircularProgress size={"1.5rem"} color="inherit" />
              ) : (
                "login"
              )}
            </button>
            <div className="bg-white w-full h-[2px]"></div>
          </div>
        </form>
        <div className="space-y-4 pt-4">
          <div className="w-full text-center font-light text-white">
            Tidak bisa login?{" "}
            <span className="font-medium underline">Hubungi kami</span>
          </div>
          <div className="flex justify-center">
            <div className="flex items-center justify-center w-12 aspect-square bg-white rounded-full">
              <Link href="https://wa.me/+6282145064560">
                <svg
                  className="fill-[#2FE900] w-6"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 448 512"
                >
                  <path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" />
                </svg>
              </Link>
            </div>
          </div>
        </div>
      </div>
    </>
  );
}
